<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: helpers/search</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: helpers/search</h1>

    




<section>

<header>
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description">Contains the functions to link data related to a search to the Search model.</div>
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    
    <dt class="tag-author">Author:</dt>
    <dd class="tag-author">
        <ul>
            <li><a href="mailto:masudm6@coventry.ac.uk">Mohammed Fardhin Masud</a></li>
        </ul>
    </dd>
    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="module-routes_search.html">module:routes/search</a> for the route which uses these functions.</li>
        
            <li>module:models/search for more about the SearchModel parameter used throughout this file.</li>
        </ul>
    </dd>
    

    
</dl>


        
    
    </div>

    

    
        <h3 class="subsection-title">Requires</h3>

        <ul>
            <li><a href="module-models_Atco.html">module:models/Atco</a></li>
        
            <li><a href="module-models_CrimeList.html">module:models/CrimeList</a></li>
        
            <li><a href="module-utils_logger.html">module:utils/logger</a></li>
        
            <li><a href="module-helpers_AtcoCodes.html">module:helpers/AtcoCodes</a></li>
        
            <li><a href="module-helpers_crime.html">module:helpers/crime</a></li>
        </ul>
    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="~getRelatedCrimes"><span class="type-signature">(async, inner) </span>getRelatedCrimes<span class="signature">(SearchModel)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Adds related crime data to the `Search` model. Requires the `Search` model to have a linked `CrimeList` already.
Populates the `Search` model's `queryCrimes` field with the `Crime`s from the `CrimeList.crimes` array.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>SearchModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The `Search` model to add the `CrimeList` details to.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line62">line 62</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>getCrimeData - fetches the crime data from the Police API, stores it as a `CrimeList` model.</li>
        
            <li>linkCrimeList - links the `CrimeList` to the `Search` model for use in this function.</li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    nothing, adds the `CrimeList` to the `Search` model.
</div>



    





        
            

    

    
    <h4 class="name" id="~getRelatedListings"><span class="type-signature">(async, inner) </span>getRelatedListings<span class="signature">(SearchModel)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Adds property data to the `Search` model.
Currently unimplemented, as the Zoopla API is discontinued.
The Urban Big Data Centre has a similar API which needs to be implemented.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>SearchModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The `Search` model to add the property data to.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line102">line 102</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="https://www.ubdc.ac.uk/data-services/data-catalogue/housing-data/zoopla-property-data/">Zoopla Property Data</a> provided by University of Glasgow's Urban Big Data Centre.</li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    nothing, adds the property data to the `Search` model's `queryListings` field.
</div>



    





        
            

    

    
    <h4 class="name" id="~getRelatedStops"><span class="type-signature">(async, inner) </span>getRelatedStops<span class="signature">(SearchModel, radius)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Finds the related bus stops to a `Search` model.
This is done by first finding and linking the associated `Atco` model using `linkAtco`.
After this, the distance is calculated from `Atco.busstops` - the closest 5 `BusStop`s to the `Search` model's `latitute` and `longitude` fields.
For now, only the first 5 `BusStop`s are returned as nothing is being calculated.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>SearchModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The `Search` model to find the related bus stops for.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>radius</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last">The radius in metres to search for bus stops in. Defaults to 1000m.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line256">line 256</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>linkAtco - Links the `Atco` model to the `Search` model.</li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    nothing, adds the `BusStop` models to the `Search` model's `relatedStops` field.
</div>



    





        
            

    

    
    <h4 class="name" id="~linkAtco"><span class="type-signature">(async, inner) </span>linkAtco<span class="signature">(SearchModel)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Links the `Atco` model to the `Search` model.
Currently called in the search route itself, instead of getRelatedStops, unlike linkCrimeList.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>SearchModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The `Search` model to link the `Atco` model to.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line217">line 217</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>linkCrimeList - links associated crimes to the `Search` model using the `CrimeList` model.</li>
        
            <li>searchAtco - Finds the correct `Atco` model to be linked.</li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    nothing, adds the `Atco` model to the `Search` model's `linkedATCO` field.
</div>



    





        
            

    

    
    <h4 class="name" id="~linkCrimeList"><span class="type-signature">(async, inner) </span>linkCrimeList<span class="signature">(SearchModel)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Links a `CrimeList` to the `Search` model by comparing the latitude value used by both.
populates the Search model's linkedCrimeList field with the returned `CrimeList` model.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>SearchModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The `Search` model to link the `CrimeList` details to.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line29">line 29</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>linkAtco - links associated busstops to the `Search` model</li>
        
            <li>getRelatedCrimes - Adds the `Crime`s to the `Search` model.</li>
        </ul>
    </dd>
    

    
</dl>













<h5>Throws:</h5>

        

<dl>
    <dt>
        <div class="param-desc">
        If no matching `CrimeList` is returned from the database.
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl>
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>


    


<h5>Returns:</h5>

        
<div class="param-desc">
    nothing - this function only links the `CrimeList` to the `Search` model.
</div>



    





        
            

    

    
    <h4 class="name" id="~searchAtco"><span class="type-signature">(async, inner) </span>searchAtco<span class="signature">(PostcodeModel)</span><span class="type-signature"> &rarr; {mongoose.Object}</span></h4>
    

    



<div class="description">
    Finds the related Atco model to link to a search.
Takes the Postcode model and finds the related Atco model by searching the county, district, region and country values.
This is necessary as region names are not consistent between the Postcode API and the Naptan API.
Take for example the region "City Of London". The Postcode API returns this as the admin_district, but in the Naptan API returns this under "Greater London".
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>PostcodeModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The Postcode model object</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line122">line 122</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>linkAtco - links associated busstops to the `Search` model</li>
        
            <li>getEnglandLocations - Generates the `Atco` model's `other_names` field for England.</li>
        
            <li>getScotlandLocations - Generates the `Atco` model's `other_names` field for Scotland.</li>
        
            <li>getWalesLocations - Generates the `Atco` model's `other_names` field for Wales.</li>
        </ul>
    </dd>
    

    
    <dt class="tag-todo">To Do:</dt>
    <dd class="tag-todo">
        <ul>
            <li>Refactor this function to be more readable - A switch/case combined with a function to search for the Atco model would be better.</li>
        </ul>
    </dd>
    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    The Atco model object to link to the Search
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">mongoose.Object</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="~updateLinks"><span class="type-signature">(async, inner) </span>updateLinks<span class="signature">(context, SearchModel)</span><span class="type-signature"> &rarr; {undefined}</span></h4>
    

    



<div class="description">
    Updates the links for a `Search` model.
The links are added to the `_links` field of the `Search` model and are used for HAL/JSON:API compliant API responses.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>context</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The Koa context object</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>SearchModel</code></td>
            

            <td class="type">
            
                
<span class="param-type">mongoose.Object</span>


            
            </td>

            

            

            <td class="description last">The `Search` model to add resource-describing links to.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="helpers_search.js.html">helpers/search.js</a>, <a href="helpers_search.js.html#line290">line 290</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="https://en.wikipedia.org/wiki/HATEOAS">https://en.wikipedia.org/wiki/HATEOAS</a> - HATEOAS compliant API responses.</li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    Nothing, updates the Search model with the links.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">undefined</span>


    </dd>
</dl>

    





        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controllers_auth.html">controllers/auth</a></li><li><a href="module-helpers_AtcoCodes.html">helpers/AtcoCodes</a></li><li><a href="module-helpers_crime.html">helpers/crime</a></li><li><a href="module-helpers_database.html">helpers/database</a></li><li><a href="module-helpers_locations.html">helpers/locations</a></li><li><a href="module-helpers_postcode.html">helpers/postcode</a></li><li><a href="module-helpers_search.html">helpers/search</a></li><li><a href="module-models_Atco.html">models/Atco</a></li><li><a href="module-models_BusStop.html">models/BusStop</a></li><li><a href="module-models_Crime.html">models/Crime</a></li><li><a href="module-models_CrimeList.html">models/CrimeList</a></li><li><a href="module-models_Nptg.html">models/Nptg</a></li><li><a href="module-models_Postcode.html">models/Postcode</a></li><li><a href="module-models_Role.html">models/Role</a></li><li><a href="module-models_Search.html">models/Search</a></li><li><a href="module-models_User.html">models/User</a></li><li><a href="module-permissions_postcodes.html">permissions/postcodes</a></li><li><a href="module-permissions_search.html">permissions/search</a></li><li><a href="module-permissions_users.html">permissions/users</a></li><li><a href="module-routes_postcodes.html">routes/postcodes</a></li><li><a href="module-routes_search.html">routes/search</a></li><li><a href="module-routes_special.html">routes/special</a></li><li><a href="module-routes_users.html">routes/users</a></li><li><a href="module-strategies_basic.html">strategies/basic</a></li><li><a href="module-utils_logger.html">utils/logger</a></li></ul><h3>Global</h3><ul><li><a href="global.html#startServer">startServer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Apr 14 2023 20:25:38 GMT+0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>